<div class="budget-container">
  <div class="budget-header">
    <div class="header-content">
      <h1><i class="fas fa-landmark"></i> Department Budget Management</h1>
      <div class="header-actions">
        <button routerLink="/profile" class="logout-btn header-btn"><i class="fas fa-user"></i> Profile</button>
        <button routerLink="/chat" class="logout-btn header-btn"><i class="fas fa-robot"></i> AI Chat</button>
        <button routerLink="/admin" *ngIf="authService.getUserRole() === 'admin'" class="logout-btn header-btn"><i class="fas fa-arrow-left"></i> Back to Admin</button>
        <button routerLink="/accounting" *ngIf="authService.getUserRole() === 'accounting'" class="logout-btn header-btn"><i class="fas fa-arrow-left"></i> Back to Accounting</button>
        <button class="logout-btn header-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </div>

  <div class="budget-content">
    <!-- Stats Overview -->
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
        <div class="stat-info">
          <h3>Total Allocated</h3>
          <p class="stat-value">{{ formatCurrency(totalAllocated) }}</p>
        </div>
      </div>

      <div class="stat-card used">
        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
        <div class="stat-info">
          <h3>Total Used</h3>
          <p class="stat-value">{{ formatCurrency(totalUsed) }}</p>
        </div>
      </div>

      <div class="stat-card remaining">
        <div class="stat-icon"><i class="fas fa-wallet"></i></div>
        <div class="stat-info">
          <h3>Total Remaining</h3>
          <p class="stat-value">{{ formatCurrency(totalRemaining) }}</p>
        </div>
      </div>

      <div class="stat-card departments">
        <div class="stat-icon"><i class="fas fa-building"></i></div>
        <div class="stat-info">
          <h3>Departments</h3>
          <p class="stat-value">{{ budgets.length }}</p>
        </div>
      </div>
    </div>

    <!-- Chart Section -->
    <div class="chart-section">
      <h2><i class="fas fa-chart-bar"></i> Budget Overview</h2>
      <div class="chart-container">
        <canvas baseChart
          [data]="barChartData"
          [options]="barChartOptions"
          [type]="'bar'">
        </canvas>
      </div>
    </div>

    <!-- Budget Table -->
    <div class="table-section">
      <h2><i class="fas fa-table"></i> Department Budget Details</h2>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Department</th>
              <th>Allocated</th>
              <th>Used</th>
              <th>Remaining</th>
              <th>Usage %</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let b of budgets">
              <td><strong>{{ b.dept }}</strong></td>
              <td>{{ formatCurrency(b.allocated) }}</td>
              <td>{{ formatCurrency(b.used) }}</td>
              <td [class.warning]="getRemaining(b) < (b.allocated * 0.1)" [class.danger]="getRemaining(b) < 0">
                {{ formatCurrency(getRemaining(b)) }}
              </td>
              <td>
                <div class="progress-container">
                  <div class="progress-bar" [style.width.%]="getUsagePercent(b)">
                    <span class="progress-text">{{ getUsagePercent(b) | number:'1.1-1' }}%</span>
                  </div>
                </div>
              </td>
            </tr>
            <tr *ngIf="budgets.length === 0">
              <td colspan="5" class="no-data">No budget data available</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
